{"ast":null,"code":"// Minimal AES-GCM encryption/decryption with PBKDF2 key derivation\n\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\nasync function deriveKeyFromPassword(password, salt, iterations = 100000) {\n  const passwordKey = await crypto.subtle.importKey('raw', textEncoder.encode(password), {\n    name: 'PBKDF2'\n  }, false, ['deriveKey']);\n  return await crypto.subtle.deriveKey({\n    name: 'PBKDF2',\n    salt,\n    iterations,\n    hash: 'SHA-256'\n  }, passwordKey, {\n    name: 'AES-GCM',\n    length: 256\n  }, false, ['encrypt', 'decrypt']);\n}\nexport async function encryptText(plaintext, password) {\n  const salt = crypto.getRandomValues(new Uint8Array(16));\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n  const key = await deriveKeyFromPassword(password, salt);\n  const data = textEncoder.encode(plaintext);\n  const cipherBuffer = await crypto.subtle.encrypt({\n    name: 'AES-GCM',\n    iv\n  }, key, data);\n  const cipherBytes = new Uint8Array(cipherBuffer);\n\n  // Package: [salt(16) | iv(12) | ciphertext(n)]\n  const output = new Uint8Array(salt.length + iv.length + cipherBytes.length);\n  output.set(salt, 0);\n  output.set(iv, salt.length);\n  output.set(cipherBytes, salt.length + iv.length);\n  return output;\n}\nexport async function decryptToText(packedBytes, password) {\n  if (!(packedBytes instanceof Uint8Array)) throw new Error('Expected Uint8Array');\n  if (packedBytes.length < 16 + 12 + 1) throw new Error('Data too short');\n  const salt = packedBytes.slice(0, 16);\n  const iv = packedBytes.slice(16, 28);\n  const ciphertext = packedBytes.slice(28);\n  const key = await deriveKeyFromPassword(password, salt);\n  const plainBuffer = await crypto.subtle.decrypt({\n    name: 'AES-GCM',\n    iv\n  }, key, ciphertext);\n  return textDecoder.decode(plainBuffer);\n}\nexport function bytesToBase64(bytes) {\n  let binary = '';\n  const chunkSize = 0x8000;\n  for (let i = 0; i < bytes.length; i += chunkSize) {\n    const slice = bytes.subarray(i, i + chunkSize);\n    binary += String.fromCharCode.apply(null, slice);\n  }\n  return btoa(binary);\n}\nexport function base64ToBytes(base64) {\n  const binary = atob(base64);\n  const bytes = new Uint8Array(binary.length);\n  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);\n  return bytes;\n}","map":{"version":3,"names":["textEncoder","TextEncoder","textDecoder","TextDecoder","deriveKeyFromPassword","password","salt","iterations","passwordKey","crypto","subtle","importKey","encode","name","deriveKey","hash","length","encryptText","plaintext","getRandomValues","Uint8Array","iv","key","data","cipherBuffer","encrypt","cipherBytes","output","set","decryptToText","packedBytes","Error","slice","ciphertext","plainBuffer","decrypt","decode","bytesToBase64","bytes","binary","chunkSize","i","subarray","String","fromCharCode","apply","btoa","base64ToBytes","base64","atob","charCodeAt"],"sources":["C:/Users/akmor/OneDrive/website/src/crypto.js"],"sourcesContent":["// Minimal AES-GCM encryption/decryption with PBKDF2 key derivation\r\n\r\nconst textEncoder = new TextEncoder();\r\nconst textDecoder = new TextDecoder();\r\n\r\nasync function deriveKeyFromPassword(password, salt, iterations = 100000) {\r\n  const passwordKey = await crypto.subtle.importKey(\r\n    'raw',\r\n    textEncoder.encode(password),\r\n    { name: 'PBKDF2' },\r\n    false,\r\n    ['deriveKey']\r\n  );\r\n\r\n  return await crypto.subtle.deriveKey(\r\n    {\r\n      name: 'PBKDF2',\r\n      salt,\r\n      iterations,\r\n      hash: 'SHA-256',\r\n    },\r\n    passwordKey,\r\n    { name: 'AES-GCM', length: 256 },\r\n    false,\r\n    ['encrypt', 'decrypt']\r\n  );\r\n}\r\n\r\nexport async function encryptText(plaintext, password) {\r\n  const salt = crypto.getRandomValues(new Uint8Array(16));\r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n  const key = await deriveKeyFromPassword(password, salt);\r\n  const data = textEncoder.encode(plaintext);\r\n  const cipherBuffer = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, data);\r\n  const cipherBytes = new Uint8Array(cipherBuffer);\r\n\r\n  // Package: [salt(16) | iv(12) | ciphertext(n)]\r\n  const output = new Uint8Array(salt.length + iv.length + cipherBytes.length);\r\n  output.set(salt, 0);\r\n  output.set(iv, salt.length);\r\n  output.set(cipherBytes, salt.length + iv.length);\r\n  return output;\r\n}\r\n\r\nexport async function decryptToText(packedBytes, password) {\r\n  if (!(packedBytes instanceof Uint8Array)) throw new Error('Expected Uint8Array');\r\n  if (packedBytes.length < 16 + 12 + 1) throw new Error('Data too short');\r\n  const salt = packedBytes.slice(0, 16);\r\n  const iv = packedBytes.slice(16, 28);\r\n  const ciphertext = packedBytes.slice(28);\r\n  const key = await deriveKeyFromPassword(password, salt);\r\n  const plainBuffer = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext);\r\n  return textDecoder.decode(plainBuffer);\r\n}\r\n\r\nexport function bytesToBase64(bytes) {\r\n  let binary = '';\r\n  const chunkSize = 0x8000;\r\n  for (let i = 0; i < bytes.length; i += chunkSize) {\r\n    const slice = bytes.subarray(i, i + chunkSize);\r\n    binary += String.fromCharCode.apply(null, slice);\r\n  }\r\n  return btoa(binary);\r\n}\r\n\r\nexport function base64ToBytes(base64) {\r\n  const binary = atob(base64);\r\n  const bytes = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);\r\n  return bytes;\r\n}\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}