{"ast":null,"code":"// Minimal AES-GCM encryption/decryption with PBKDF2 key derivation\nconst textEncoder=new TextEncoder();const textDecoder=new TextDecoder();async function deriveKeyFromPassword(password,salt){let iterations=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100000;const passwordKey=await crypto.subtle.importKey('raw',textEncoder.encode(password),{name:'PBKDF2'},false,['deriveKey']);return await crypto.subtle.deriveKey({name:'PBKDF2',salt,iterations,hash:'SHA-256'},passwordKey,{name:'AES-GCM',length:256},false,['encrypt','decrypt']);}export async function encryptText(plaintext,password){const salt=crypto.getRandomValues(new Uint8Array(16));const iv=crypto.getRandomValues(new Uint8Array(12));const key=await deriveKeyFromPassword(password,salt);const data=textEncoder.encode(plaintext);const cipherBuffer=await crypto.subtle.encrypt({name:'AES-GCM',iv},key,data);const cipherBytes=new Uint8Array(cipherBuffer);const output=new Uint8Array(salt.length+iv.length+cipherBytes.length);output.set(salt,0);output.set(iv,salt.length);output.set(cipherBytes,salt.length+iv.length);return output;}export async function decryptToText(packedBytes,password){if(!(packedBytes instanceof Uint8Array))throw new Error('Expected Uint8Array');if(packedBytes.length<29)throw new Error('Data too short');const salt=packedBytes.slice(0,16);const iv=packedBytes.slice(16,28);const ciphertext=packedBytes.slice(28);const key=await deriveKeyFromPassword(password,salt);const plainBuffer=await crypto.subtle.decrypt({name:'AES-GCM',iv},key,ciphertext);return textDecoder.decode(plainBuffer);}export function bytesToBase64(bytes){let binary='';const chunkSize=0x8000;for(let i=0;i<bytes.length;i+=chunkSize){const slice=bytes.subarray(i,i+chunkSize);binary+=String.fromCharCode.apply(null,slice);}return btoa(binary);}export function base64ToBytes(base64){const binary=atob(base64);const out=new Uint8Array(binary.length);for(let i=0;i<binary.length;i++)out[i]=binary.charCodeAt(i);return out;}","map":{"version":3,"names":["textEncoder","TextEncoder","textDecoder","TextDecoder","deriveKeyFromPassword","password","salt","iterations","arguments","length","undefined","passwordKey","crypto","subtle","importKey","encode","name","deriveKey","hash","encryptText","plaintext","getRandomValues","Uint8Array","iv","key","data","cipherBuffer","encrypt","cipherBytes","output","set","decryptToText","packedBytes","Error","slice","ciphertext","plainBuffer","decrypt","decode","bytesToBase64","bytes","binary","chunkSize","i","subarray","String","fromCharCode","apply","btoa","base64ToBytes","base64","atob","out","charCodeAt"],"sources":["C:/Users/akmor/OneDrive/website/src/crypto.js"],"sourcesContent":["// Minimal AES-GCM encryption/decryption with PBKDF2 key derivation\r\nconst textEncoder = new TextEncoder();\r\nconst textDecoder = new TextDecoder();\r\n\r\nasync function deriveKeyFromPassword(password, salt, iterations = 100000) {\r\n  const passwordKey = await crypto.subtle.importKey(\r\n    'raw',\r\n    textEncoder.encode(password),\r\n    { name: 'PBKDF2' },\r\n    false,\r\n    ['deriveKey']\r\n  );\r\n\r\n  return await crypto.subtle.deriveKey(\r\n    { name: 'PBKDF2', salt, iterations, hash: 'SHA-256' },\r\n    passwordKey,\r\n    { name: 'AES-GCM', length: 256 },\r\n    false,\r\n    ['encrypt', 'decrypt']\r\n  );\r\n}\r\n\r\nexport async function encryptText(plaintext, password) {\r\n  const salt = crypto.getRandomValues(new Uint8Array(16));\r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n  const key = await deriveKeyFromPassword(password, salt);\r\n  const data = textEncoder.encode(plaintext);\r\n  const cipherBuffer = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, data);\r\n  const cipherBytes = new Uint8Array(cipherBuffer);\r\n  const output = new Uint8Array(salt.length + iv.length + cipherBytes.length);\r\n  output.set(salt, 0);\r\n  output.set(iv, salt.length);\r\n  output.set(cipherBytes, salt.length + iv.length);\r\n  return output;\r\n}\r\n\r\nexport async function decryptToText(packedBytes, password) {\r\n  if (!(packedBytes instanceof Uint8Array)) throw new Error('Expected Uint8Array');\r\n  if (packedBytes.length < 29) throw new Error('Data too short');\r\n  const salt = packedBytes.slice(0, 16);\r\n  const iv = packedBytes.slice(16, 28);\r\n  const ciphertext = packedBytes.slice(28);\r\n  const key = await deriveKeyFromPassword(password, salt);\r\n  const plainBuffer = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext);\r\n  return textDecoder.decode(plainBuffer);\r\n}\r\n\r\nexport function bytesToBase64(bytes) {\r\n  let binary = '';\r\n  const chunkSize = 0x8000;\r\n  for (let i = 0; i < bytes.length; i += chunkSize) {\r\n    const slice = bytes.subarray(i, i + chunkSize);\r\n    binary += String.fromCharCode.apply(null, slice);\r\n  }\r\n  return btoa(binary);\r\n}\r\n\r\nexport function base64ToBytes(base64) {\r\n  const binary = atob(base64);\r\n  const out = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i++) out[i] = binary.charCodeAt(i);\r\n  return out;\r\n}\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}